// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace SISTEMA.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\_Imports.razor"
using SISTEMA;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\_Imports.razor"
using SISTEMA.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\Pages\Factura.razor"
using System.Collections;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\Pages\Factura.razor"
using MySql.Data.MySqlClient;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/Factura/generar")]
    public partial class Factura : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 162 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\Pages\Factura.razor"
      
    int cliente_id = 0;
    int servicio_id = 0;
    int estado_factura = 0;
    DateTime fecha;
    int TotalFacturas;
    int monto;
    
    System.Collections.ArrayList Clientes = new System.Collections.ArrayList();
    System.Collections.ArrayList Servicios = new System.Collections.ArrayList();
    System.Collections.ArrayList ServiciosID = new System.Collections.ArrayList();
    System.Collections.ArrayList ServiciosPrecios = new System.Collections.ArrayList();
    System.Collections.ArrayList ClientesDirecciones = new System.Collections.ArrayList();
    System.Collections.ArrayList ClientesTelefonos = new System.Collections.ArrayList();
    System.Collections.ArrayList Estadodefactura = new System.Collections.ArrayList();
    System.Collections.ArrayList ServiciosPorFacturar = new System.Collections.ArrayList();

    public void imprimir(){
        js.InvokeVoidAsync("print");
    }

    public void AgregarServicios(){
        ServiciosPorFacturar.Add(servicio_id);
        monto += Int32.Parse(ServiciosPrecios[servicio_id].ToString());
    }

    void Generar(){
        if(ServiciosPorFacturar == null || monto == 0){
            return;
        }

        try{
            MySqlCommand command = new MySqlCommand("INSERT INTO Factura(codigo,cliente,estado) VALUES (@m_codigo,@m_cliente,@m_estado);");
            command.Parameters.AddWithValue("@m_codigo",TotalFacturas);
            command.Parameters.AddWithValue("@m_cliente",cliente_id + 1);
            command.Parameters.AddWithValue("@m_estado",estado_factura + 1);

            if(dbaccess.ExecuteQuery(command) != -1){
                Console.WriteLine("Factura registrada correctamente");
            }
        }catch{
            Console.WriteLine("Error al momento de registrar la factura");
        }

        imprimir();
    }

    protected async override Task OnInitializedAsync()
    {
        Clientes = dbaccess.GetListFromDataBase("SELECT nombre FROM Clientes;","nombre");
        ClientesDirecciones = dbaccess.GetListFromDataBase("SELECT direccion FROM Clientes","direccion");
        ClientesTelefonos = dbaccess.GetListFromDataBase("SELECT telefono FROM Clientes", "telefono");
        ServiciosPrecios = dbaccess.GetListFromDataBase("SELECT precio FROM Servicios;","precio");
        Servicios = dbaccess.GetListFromDataBase("SELECT servicio AS descripcion FROM Servicios;","descripcion");
        ServiciosID = dbaccess.GetListFromDataBase("SELECT codigo FROM Servicios;","codigo");
        Estadodefactura = dbaccess.GetListFromDataBase("SELECT nombre FROM EstadoFactura;","nombre");
        MySql.Data.MySqlClient.MySqlDataReader tmp = dbaccess.ReadDataThroughtReader("SELECT COUNT(*) AS CANTIDAD FROM Factura");
        while(tmp.Read()){ TotalFacturas = Int32.Parse(tmp["CANTIDAD"].ToString()); TotalFacturas += 1; }
        tmp.Close();
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime js { get; set; }
    }
}
#pragma warning restore 1591
