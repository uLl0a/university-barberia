// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace SISTEMA.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\_Imports.razor"
using SISTEMA;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\_Imports.razor"
using SISTEMA.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\Pages\Citas.razor"
using System.Collections;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\Pages\Citas.razor"
using MySql.Data.MySqlClient;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/Citas")]
    public partial class Citas : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 87 "C:\Users\University\Documents\Universidad\Septimo trimestre\INGENIERIA DE SOFTWARE II\PROYECTO FINAL\SISTEMA\Pages\Citas.razor"
       
    bool AddMode = false;
    bool EditMode = false;
    int cita_id = 0;
    int cliente_id = 0;
    int empleado_id = 0;
    int estado_id = 0;
    DateTime fecha;

    System.Data.DataTable CitasTable = new System.Data.DataTable();
    System.Collections.ArrayList Clientes = new ArrayList();
    System.Collections.ArrayList Empleados = new ArrayList();
    System.Collections.ArrayList Estados = new ArrayList();
    void ChangeStateToAddMode(){
        AddMode = !AddMode;
    }

    void ChangeStateToEditMode(){
        if(cita_id <= 0){
            return;
        }
        try{
            System.Data.DataTable table = dbaccess.ReadDataThroughtAdapter($"SELECT * FROM Citas WHERE id = {cita_id}");
            estado_id = (int)Convert.ChangeType(table.Rows[0]["estado"].ToString(), (typeof(int)));
            fecha = DateTime.Parse(table.Rows[0]["fecha"].ToString());
            AddMode = !AddMode;
            EditMode = !EditMode;
        }catch(Exception e){
            Console.WriteLine(e);
        }

    }

    void CancelarModo(){
        AddMode = false;
        EditMode = false;
    }

    protected async override Task OnInitializedAsync(){
        try{
            CitasTable = dbaccess.ReadDataThroughtAdapter("SELECT Citas.id AS ID, empleados.nombre AS Empleado, clientes.nombre AS Cliente, Estadoscitas.nombre AS Estado, fecha AS 'Fecha y Hora' FROM clientes, Estadoscitas, citas, empleados WHERE empleados.id = citas.empleado AND clientes.id = citas.cliente AND Estadoscitas.id = Citas.estado;");
            Clientes = dbaccess.GetListFromDataBase("SELECT nombre FROM Clientes;", "nombre");
            Empleados = dbaccess.GetListFromDataBase("SELECT nombre FROM Empleados;", "nombre");
            Estados = dbaccess.GetListFromDataBase("SELECT nombre FROM Estadoscitas;", "nombre");
        }catch(Exception e){
            Console.WriteLine(e);
        }
    }

    void SaveCita()
    {
        if(estado_id <= 0 || cliente_id <= 0 || empleado_id <= 0)
        {
            return;
        }

        try{
            MySqlCommand command = new MySqlCommand("INSERT INTO Citas(cliente,empleado,fecha,estado) VALUES (@m_cliente_id,@m_empleado_id,@m_fecha,@m_estado_id);");
            command.Parameters.AddWithValue("@m_cliente_id",cliente_id);
            command.Parameters.AddWithValue("@m_empleado_id",empleado_id);
            command.Parameters.AddWithValue("@m_fecha",fecha);
            command.Parameters.AddWithValue("@m_estado_id",estado_id);

            if(dbaccess.ExecuteQuery(command) != -1){
                Console.WriteLine("Cita registrada correctamente");
            }
        }catch{
            Console.WriteLine("Error al momento de registrar la cita");
        } 
    AddMode = !AddMode;
    }

    void UpdateCita()
    {
    if(estado_id <= 0)
        {
            return;
        }

        try{
            MySqlCommand command = new MySqlCommand("UPDATE Citas SET estado=@m_estado_id, fecha=@m_fecha WHERE id=@m_id;");
            command.Parameters.AddWithValue("@m_estado_id",estado_id);
            command.Parameters.AddWithValue("@m_fecha",fecha);
            command.Parameters.AddWithValue("@m_id",cita_id);

            if(dbaccess.ExecuteQuery(command) != -1){
                Console.WriteLine("Cita registrada correctamente");
            }
        }catch{
            Console.WriteLine("Error al momento de registrar la cita");
        } 
    AddMode = !AddMode;
    EditMode = !EditMode;
    }

    void FindCita(){
        if(cita_id <=0){
            return;
        }
        CitasTable = dbaccess.ReadDataThroughtAdapter($"SELECT Citas.id AS ID, empleados.nombre AS Empleado, clientes.nombre AS Cliente, Estadoscitas.nombre AS Estado, fecha AS 'Fecha y Hora' FROM clientes, Estadoscitas, citas, empleados WHERE empleados.id = citas.empleado AND clientes.id = citas.cliente AND Estadoscitas.id = Citas.estado AND Citas.id = {cita_id}");
    }


#line default
#line hidden
#nullable disable
    }
}
#pragma warning restore 1591
